# 프로세스 주소 공간

<br />

프로세스는 운영체제가 자원을 할당하는 단위이다.

프로세스가 메모리를 할당 받으면, 자신만의 방법으로 메모리를 관리하기 위해 이 공간들을 어떤 구조로 관리하는데, 우리는 이를 프로세스 주소 공간이라고 부른다. 

<br />

<img src="https://velog.velcdn.com/images%2Fklm03025%2Fpost%2Fcd3ef853-de73-4a07-b062-263ff9d1acdc%2Fimage.png" />

<br />

프로세스 주소공간은 다음과 같이 나뉘어진다. 

## Stack 영역

<br />

함수의 호출과 관계되는 지역변수와 매개변수가 저장되는 영역.

Stack 영역의 값은 함수의 호출과 함께 할당되며, 함수의 호출이 완료되면 소멸한다.

메모리의 높은 주소에서 낮은 주소의 방향으로 할당된다. 

재귀 함수가 너무 깊게 호출되거나 함수가 지역변수를 너무 많이 가지고 있어 stack 영역을 초과하면 stack overflow 에러가 발생한다. 

<br />

## Heap 영역

<br />

런타임에 크기가 결정되는 영역. 사용자에 의해 공간이 동적으로 할당 및 해제된다.

주로 참조형 데이터 (ex. 클래스) 등의 데이터가 할당된다.

메모리의 낮은 주소에서 높은 주소의 방향으로 할당된다.

<br />

## Data 영역

<br />

전역 변수나 Static 변수 등 프로그램이 사용할 수 있는 데이터를 저장하는 영역이다.

어떤 프로그램에 전역/static 변수를 참조하는 코드가 존재한다면, 이 프로그램은 컴파일 된 후에 data 영역을 참조하게 된다.

프로그램의 시작과 함께 할당되며, 프로그램이 종료되면 소멸한다.

단, 초기화 되지 않은 변수가 존재한다면, 이는 (그림에는 표현되지는 않았지만 BSS 영역에 저장된다.)

<br />

## Text(Code) 영역

<br />

프로그램이 실행될 수 있도록 CPU가 해석 가능한 기계어 코드가 저장되어 있는 공간으로, 

프로그램이 수정되면 안 되므로 ReadOnly 상태로 저장 되어있다.

결국 메모리는 한정되어 있기 때문에, 프로세스는 다양한 방법으로 메모리를 절약하려고 시도한다. 

<br />

## Data 영역과 Stack 영역

<br />

Code 영역은 기계어 코드가 들어있으니 다른 구역과 너무 다르고, Heap 영역은 런타임에 크기가 결정되는 영역이다.

그렇다면 Stack 영역과 Data 영역을 구분한 이유는 무엇일까? 가장 큰 이유는 역할의 분배이다. 

우리는 Stack 영역을 통해 함수의 흐름을 관리하고, Data 영역을 통해 전역 변수, static 변수를 관리한다.

만약 한 프로세스가 여러개의 스레드를 갖는다면, 각각의 스레드는 자신만의 Stack 영역을 갖는다. 

이는 스레드 내에서 수행되는 함수의 흐름을 각각 관리하기 위함이다.

여기에서 영역을 구분한 또 다른 중요한 이유가 나오는데, 바로 Data 영역의 공유이다. 

각각의 스레드는 Stack 영역을 갖긴 하지만 Data 영역은 공유한다. 

즉, 각각의 스레드가 사용하기 위해 Data 영역의 동일한 내용을 공유함으로써, 똑같은 공간을 여러개 만들지 않고 메모리를 절약할 수 있다.

<br />

---

## Sources

<br />

[참고 링크](https://velog.io/@klm03025/%EC%9A%B4%EC%98%81%EC%B2%B4%EC%A0%9C-%ED%94%84%EB%A1%9C%EC%84%B8%EC%8A%A4-%EC%A3%BC%EC%86%8C-%EA%B3%B5%EA%B0%84)

[참고 링크](https://gyoogle.dev/blog/computer-science/operating-system/Process%20Address%20Space.html)

[참고 링크](https://whereisusb.tistory.com/10)
