# Redis

> 빠른 오픈 소스 인 메모리 키 값 데이터 구조 스토어

## Redis의 정의

<br />

Key - Value 구조의 비정형 데이터를 저장하고 관리하기 위한 오픈 소스 기반의 비관계형 데이터 베이스 관리 시스템이다. 

데이터베이스, 캐시, 메세지 브로커로 사용되며 인메모리 데이터 구조를 가진 저장소이다. 

**db.engines.com에서 Key-value store중에 가장 순위가 높다**

<br />

---

## Redis의 특징

<br />

보통 데이터베이스는 하드 디스크나 SSD에 저장한다. 

하지만 Redis는 메모리(RAM)에 저장해서 디스크 스캐닝이 필요없어 매우 빠르다. 

캐싱도 가능하기 때문에 실시간 채팅에 적합하며 세션 공유를 위해 세션 클러스터링에도 활용된다. 

<br />

---

### 캐시 서버의 패턴

<br />

캐시 서버는 Look aside cache 패턴과 Write Back 패턴이 존재한다. 

<br />

### - Look aside cache

<br />
1. 클라이언트가 데이터를 요청

2. 웹서버는 데이터가 존재하는지 Cache 서버에 먼저 확인

3. Cache 서버에 데이터가 있으면 DB에 데이터를 조회하지 않고 Cache 서버에 있는 결과값을 클라이언트에게 바로 반환 (Cache Hit)

4. Cache 서버에 데이터가 없으면 DB에 데이터를 조회하여 Cache 서버에 저장하고 결과값을 클라이언트에게 반환 (Cache Miss)

<br />
 
### - Write Back 

<br />

1. 웹서버는 모든 데이터를 Cache 서버에 저장

2. Cache 서버에 특정 시간 동안 데이터가 저장됨

3. Cache 서버에 있는 데이터를 DB에 저장

4. DB에 저장된 Cache 서버의 데이터를 삭제

<br />
 
* insert 쿼리를 한 번씩 500번 날리는 것보다 insert 쿼리 500개를 붙여서 한 번에 날리는 것이 더 효율적이라는 원리다.

* 이 방식은 들어오는 데이터들이 저장되기 전에 메모리 공간에 머무르는데 이때 서버에 장애가 발생하여 다운된다면 데이터가 손실될 수 있다는 단점이 있다.

<br />

---

## ...Redis의 특징

<br />

그러나 이 때, RAM은 휘발성이라 컴퓨터가 꺼지면 정보가 다 날아가버린다는 약점이 있다.

이를 막기위한 백업 과정이 다음 두 가지로 나뉜다.

<br />

1. Snapshot : 특정 지점을 설정하고 디스크에 백업.
2. AOF      : 명령(쿼리)들을 저장해두고, 서버가 셧다운되면 재실행해서 다시 만들어 놓는 것.

<br />

Redis의 경우 Key-value구조이기 때문에 쿼리를 사용할 필요가 없다. 대신 Redis 명령어를 사용한다.

지원하는 자료구조는 String, Sets, Lists, Sorted Sets, Hashes 자료구조가 있다.

또한 레디스는 Single Threaded이다. 따라서 한 번에 하나의 명령만 처리할 수 있다. 

그렇기 때문에 동기적으로 명령들이 처리가 되는데, get, set 명령어의 경우 초당 처리속도가 10만개를 넘어가기 때문에 의미는 없다. 

<br />

---

## Redis 사용의 주의할 점

<br />

서버에 장애가 발생했을 경우 그에 대한 운영 플랜이 반드시 필요하다. 

인메모리 저장방식이기 때문에 데이터 유실이 발생할 수 있는데, 이것을 어떻게 효과적으로 방지할 것인지?

또한, 당연한 얘기지만, 메모리 관리가 매우 중요하다.

그리고 싱글 스레드의 특성상 한 번에 하나의 명령만을 처리하기 때문에, 처리하는데 시간이 오래 걸릴 수 있는 요청은 최대한 피하는 것이 좋겠다. 

<br />

---

## Sources 

[참고 링크](https://devlog-wjdrbs96.tistory.com/374)

[참고 링크](https://wildeveloperetrain.tistory.com/21)